<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Gmail in Emacs with mbsync and mu4e | Cash Weaver</title>
<meta name=keywords content="doom-emacs,emacs,email,gmail">
<meta name=description content="This is a guide to setting up access to email from a Gmail account (eg: @gmail.com) within doom emacs using mu, mbsync (isync), and mu4e (mu for emacs).
You may have to complete additional steps if you are not using doom emacs, Gmail, or if your set-up differs from mine in other ways.
Prerequisites Please be sure you&rsquo;ve completed these steps before continuing:
Required Software    We will use `mbsync` to download our email.">
<meta name=author content="Cash Weaver">
<link rel=canonical href=http://cashweaver.com/posts/read-email-in-emacs-with-mbsync-isync-and-mu4e/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://cashweaver.com/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=http://cashweaver.com/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=http://cashweaver.com/favicon-32x32.png>
<link rel=apple-touch-icon href=http://cashweaver.com/apple-touch-icon.png>
<link rel=mask-icon href=http://cashweaver.com/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.4">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Gmail in Emacs with mbsync and mu4e">
<meta property="og:description" content="This is a guide to setting up access to email from a Gmail account (eg: @gmail.com) within doom emacs using mu, mbsync (isync), and mu4e (mu for emacs).
You may have to complete additional steps if you are not using doom emacs, Gmail, or if your set-up differs from mine in other ways.
Prerequisites Please be sure you&rsquo;ve completed these steps before continuing:
Required Software    We will use `mbsync` to download our email.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://cashweaver.com/posts/read-email-in-emacs-with-mbsync-isync-and-mu4e/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-04-24T00:00:00+00:00">
<meta property="article:modified_time" content="2021-04-24T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Gmail in Emacs with mbsync and mu4e">
<meta name=twitter:description content="This is a guide to setting up access to email from a Gmail account (eg: @gmail.com) within doom emacs using mu, mbsync (isync), and mu4e (mu for emacs).
You may have to complete additional steps if you are not using doom emacs, Gmail, or if your set-up differs from mine in other ways.
Prerequisites Please be sure you&rsquo;ve completed these steps before continuing:
Required Software    We will use `mbsync` to download our email.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://cashweaver.com/posts/"},{"@type":"ListItem","position":2,"name":"Gmail in Emacs with mbsync and mu4e","item":"http://cashweaver.com/posts/read-email-in-emacs-with-mbsync-isync-and-mu4e/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Gmail in Emacs with mbsync and mu4e","name":"Gmail in Emacs with mbsync and mu4e","description":"This is a guide to setting up access to email from a Gmail account (eg: @gmail.com) within doom emacs using mu, mbsync (isync), and mu4e (mu for emacs).\nYou may have to complete additional steps if you are not using doom emacs, Gmail, or if your set-up differs from mine in other ways.\nPrerequisites Please be sure you\u0026rsquo;ve completed these steps before continuing:\nRequired Software    We will use `mbsync` to download our email.","keywords":["doom-emacs","emacs","email","gmail"],"articleBody":"This is a guide to setting up access to email from a Gmail account (eg: @gmail.com) within doom emacs using mu, mbsync (isync), and mu4e (mu for emacs).\nYou may have to complete additional steps if you are not using doom emacs, Gmail, or if your set-up differs from mine in other ways.\nPrerequisites Please be sure you’ve completed these steps before continuing:\nRequired Software    We will use `mbsync` to download our email. It is essential that the version is greater than or equal to 1.3.3 to ensure the OAuth2 token is not cut off (see line 1891 in [drv_imap.c](https://sourceforge.net/p/isync/isync/ci/v1.3.3/tree/src/drv_imap.c)) ```sh git clone https://git.code.sf.net/p/isync/isync isync cd isync ./autogen.sh ./configure make sudo make install ```    `mu` will index the emails we've downloaded with `mbsync` and provide them to the `mu4e` package. ```sh sudo apt install maildir-utils ```    `mu4e` is our email client within emacs. ```sh sudo apt install mu4e ```    This utility will generate our refersh tokens for us. ```sh git clone https://github.com/google/gmail-oauth2-tools ```    `mbsync` doesn't support OAuth2, so we'll install a plugin which enables it. ```sh # Reference: https://unix.stackexchange.com/a/632794/423626 # Clone the Cyrus SASL OAuth2 sources. git clone https://github.com/moriyoshi/cyrus-sasl-xoauth2.git # Configure and make. cd cyrus-sasl-xoauth2 ./autogen.sh ./configure # SASL2 libraries on Ubuntu are in /usr/lib/x86_64-linux-gnu/; modify the Makefile accordingly sed -i 's%pkglibdir = ${CYRUS_SASL_PREFIX}/lib/sasl2%pkglibdir = ${CYRUS_SASL_PREFIX}/lib/x86_64-linux-gnu/sasl2%' Makefile make sudo make install # Install saslpluginviewer sudo apt install sasl2-bin # Verify XOAUTH2 is known to SASL. saslpluginviewer | grep XOAUTH2 ```  Create an OAuth2 Client ID Please refer to: Create an OAuth2 Client ID\nCreate mbsyncrc     ``` # Account Information IMAPAccount gmail Host imap.gmail.com User cashbweaver@gmail.com AuthMechs XOAUTH2 PassCmd \"/path/to/gen_email_access_token.sh\" SSLType IMAPS IMAPStore gmail-remote Account gmail MaildirStore gmail-local Path ~/.mail/cashweaver-gmail Inbox ~/.mail/cashweaver-gmail/inbox Channel gmail-inbox Far :gmail-remote: Near :gmail-local: Patterns \"INBOX\" Channel gmail-sent Far :gmail-remote:\"[Gmail]/Sent Mail\" Near :gmail-local:sent Remove Near Create near SyncState * Channel gmail-trash Far :gmail-remote:\"[Gmail]/Trash\" Near :gmail-local:trash Remove Near Create near SyncState * Channel gmail-drafts Far :gmail-remote:\"[Gmail]/Drafts\" Near :gmail-local:drafts Remove Near Create near SyncState * Group gmail Channel gmail-inbox Channel gmail-sent Channel gmail-trash Channel gmail-drafts ```  Emable IMAP in your Gmail Account Follow the documentation to enable IMAP.\nEnable mu4e within emacs This step is written for those using doom emacs. Those using other flavors of emacs will need to enable mu4e on their own.\n    ```sh doom sync ```    Sync and Index Your Email Follow the steps documented by doom emacs' mu4e section.\n   This may take a while.    ```sh mu init --maildir ~/.mail --my-address @gmail.com mu index ```    As an example: ```common_lisp ;; Each path is relative to `+mu4e-mu4e-mail-path', which is ~/.mail by default (set-email-account! \"gmail.com\" '((mu4e-sent-folder . \"/gmail.com/Sent Mail\") (mu4e-drafts-folder . \"/gmail.com/Drafts\") (mu4e-trash-folder . \"/gmail.com/Trash\") (mu4e-refile-folder . \"/gmail.com/All Mail\") (smtpmail-smtp-user . \"@gmail.com\") (mu4e-compose-signature . \"\")) ```  ","wordCount":"450","inLanguage":"en","datePublished":"2021-04-24T00:00:00Z","dateModified":"2021-04-24T00:00:00Z","author":[{"@type":"Person","name":"Cash Weaver"}],"mainEntityOfPage":{"@type":"WebPage","@id":"http://cashweaver.com/posts/read-email-in-emacs-with-mbsync-isync-and-mu4e/"},"publisher":{"@type":"Organization","name":"Cash Weaver","logo":{"@type":"ImageObject","url":"http://cashweaver.com/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=http://cashweaver.com/ accesskey=h title="Cash Weaver (Alt + H)">Cash Weaver</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=http://cashweaver.com/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Gmail in Emacs with mbsync and mu4e
</h1>
<div class=post-meta><span title="2021-04-24 00:00:00 +0000 UTC">April 24, 2021</span>&nbsp;·&nbsp;Cash Weaver
</div>
</header>
<div class=post-content><p>This is a guide to setting up access to email from a Gmail account (eg: @gmail.com) within <a href=https://github.com/hlissner/doom-emacs><code>doom emacs</code></a> using <code>mu</code>, <code>mbsync</code> (<code>isync</code>), and <code>mu4e</code> (<code>mu</code> for <code>emacs</code>).</p>
<p>You may have to complete additional steps if you are not using <a href=https://github.com/hlissner/doom-emacs><code>doom emacs</code></a>, Gmail, or if your set-up differs from mine in other ways.</p>
<h2 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h2>
<p>Please be sure you&rsquo;ve completed these steps before continuing:</p>
<h3 id=required-software>Required Software<a hidden class=anchor aria-hidden=true href=#required-software>#</a></h3>
<ol>
<li></li>
</ol>
<pre><code>We will use `mbsync` to download our email. It is essential that the version is greater than or equal to 1.3.3 to ensure the OAuth2 token is not cut off (see line 1891 in [drv_imap.c](https://sourceforge.net/p/isync/isync/ci/v1.3.3/tree/src/drv_imap.c))

```sh
git clone https://git.code.sf.net/p/isync/isync isync
cd isync
./autogen.sh
./configure
make
sudo make install
```
</code></pre>
<ol start=2>
<li></li>
</ol>
<pre><code>`mu` will index the emails we've downloaded with `mbsync` and provide them to the `mu4e` package.

```sh
sudo apt install maildir-utils
```
</code></pre>
<ol start=3>
<li></li>
</ol>
<pre><code>`mu4e` is our email client within emacs.

```sh
sudo apt install mu4e
```
</code></pre>
<ol start=4>
<li></li>
</ol>
<pre><code>This utility will generate our refersh tokens for us.

```sh
git clone https://github.com/google/gmail-oauth2-tools
```
</code></pre>
<ol start=5>
<li></li>
</ol>
<pre><code>`mbsync` doesn't support OAuth2, so we'll install a plugin which enables it.

```sh
# Reference: https://unix.stackexchange.com/a/632794/423626
# Clone the Cyrus SASL OAuth2 sources.
git clone https://github.com/moriyoshi/cyrus-sasl-xoauth2.git

# Configure and make.
cd cyrus-sasl-xoauth2
./autogen.sh
./configure

# SASL2 libraries on Ubuntu are in /usr/lib/x86_64-linux-gnu/; modify the Makefile accordingly
sed -i 's%pkglibdir = ${CYRUS_SASL_PREFIX}/lib/sasl2%pkglibdir = ${CYRUS_SASL_PREFIX}/lib/x86_64-linux-gnu/sasl2%' Makefile

make
sudo make install

# Install saslpluginviewer
sudo apt install sasl2-bin

# Verify XOAUTH2 is known to SASL.
saslpluginviewer | grep XOAUTH2
```
</code></pre>
<h3 id=create-an-oauth2-client-id>Create an OAuth2 Client ID<a hidden class=anchor aria-hidden=true href=#create-an-oauth2-client-id>#</a></h3>
<p>Please refer to: <a href=/create-an-oauth2-client-id-for-gmail>Create an OAuth2 Client ID</a></p>
<h3 id=create-mbsyncrc>Create <code>mbsyncrc</code><a hidden class=anchor aria-hidden=true href=#create-mbsyncrc>#</a></h3>
<ol>
<li></li>
<li></li>
</ol>
<pre><code>```
# Account Information
IMAPAccount gmail
Host imap.gmail.com
User cashbweaver@gmail.com
AuthMechs XOAUTH2
PassCmd &quot;/path/to/gen_email_access_token.sh&quot;
SSLType IMAPS

IMAPStore gmail-remote
Account gmail

MaildirStore gmail-local
Path ~/.mail/cashweaver-gmail
Inbox ~/.mail/cashweaver-gmail/inbox

Channel gmail-inbox
Far :gmail-remote:
Near :gmail-local:
Patterns &quot;INBOX&quot;

Channel gmail-sent
Far :gmail-remote:&quot;[Gmail]/Sent Mail&quot;
Near :gmail-local:sent
Remove Near
Create near
SyncState *

Channel gmail-trash
Far :gmail-remote:&quot;[Gmail]/Trash&quot;
Near :gmail-local:trash
Remove Near
Create near
SyncState *

Channel gmail-drafts
Far :gmail-remote:&quot;[Gmail]/Drafts&quot;
Near :gmail-local:drafts
Remove Near
Create near
SyncState *

Group gmail
Channel gmail-inbox
Channel gmail-sent
Channel gmail-trash
Channel gmail-drafts
```
</code></pre>
<h3 id=emable-imap-in-your-gmail-account>Emable IMAP in your Gmail Account<a hidden class=anchor aria-hidden=true href=#emable-imap-in-your-gmail-account>#</a></h3>
<p>Follow the <a href="https://support.google.com/mail/answer/7126229?hl=en">documentation</a> to enable IMAP.</p>
<h3 id=enable-mu4e-within-emacs>Enable <code>mu4e</code> within <code>emacs</code><a hidden class=anchor aria-hidden=true href=#enable-mu4e-within-emacs>#</a></h3>
<p>This step is written for those using <a href=https://github.com/hlissner/doom-emacs><code>doom emacs</code></a>. Those using other flavors of <code>emacs</code> will need to enable <code>mu4e</code> on their own.</p>
<ol>
<li></li>
<li></li>
</ol>
<pre><code>```sh
doom sync
```
</code></pre>
<ol start=3>
<li></li>
</ol>
<h2 id=sync-and-index-your-email>Sync and Index Your Email<a hidden class=anchor aria-hidden=true href=#sync-and-index-your-email>#</a></h2>
<p>Follow the steps documented by <a href=https://github.com/hlissner/doom-emacs/blob/develop/modules/email/mu4e/README.org>doom emacs' mu4e section</a>.</p>
<ol>
<li></li>
</ol>
<pre><code>This may take a while.
</code></pre>
<ol start=2>
<li></li>
</ol>
<pre><code>```sh
mu init --maildir ~/.mail --my-address &lt;you&gt;@gmail.com
mu index
```
</code></pre>
<ol start=3>
<li></li>
</ol>
<pre><code>As an example:

```common_lisp
;; Each path is relative to `+mu4e-mu4e-mail-path', which is ~/.mail by default
(set-email-account! &quot;gmail.com&quot;
                    '((mu4e-sent-folder       . &quot;/gmail.com/Sent Mail&quot;)
                      (mu4e-drafts-folder     . &quot;/gmail.com/Drafts&quot;)
                      (mu4e-trash-folder      . &quot;/gmail.com/Trash&quot;)
                      (mu4e-refile-folder     . &quot;/gmail.com/All Mail&quot;)
                      (smtpmail-smtp-user     . &quot;&lt;you&gt;@gmail.com&quot;)
                      (mu4e-compose-signature . &quot;&lt;Your signature here&gt;&quot;))
```
</code></pre>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=http://cashweaver.com/tags/doom-emacs/>doom-emacs</a></li>
<li><a href=http://cashweaver.com/tags/emacs/>emacs</a></li>
<li><a href=http://cashweaver.com/tags/email/>email</a></li>
<li><a href=http://cashweaver.com/tags/gmail/>gmail</a></li>
</ul>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=http://cashweaver.com/>Cash Weaver</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>